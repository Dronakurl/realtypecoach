<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Practice</title>
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Roboto Mono', 'Consolas', monospace;
            max-width: 900px; margin: 40px auto; padding: 20px;
            background: #1a1a1a; color: #e0e0e0;
        }
        .stats {
            display: flex; gap: 20px; margin-bottom: 20px;
            font-size: 18px;
        }
        .stat { background: #2a2a2a; padding: 10px 20px; border-radius: 5px; }
        .stat-value { font-size: 24px; font-weight: bold; color: #4CAF50; }
        #textDisplay {
            font-size: 20px; line-height: 1.8; margin-bottom: 20px;
            background: #2a2a2a; padding: 20px; border-radius: 5px;
            white-space: pre-wrap; word-break: break-word;
        }
        .correct { color: #4CAF50; }
        .incorrect { color: #f44336; text-decoration: underline; }
        .current { background: #FFC107; color: #000; border-radius: 2px; }
        #input {
            width: 100%; height: 100px; font-size: 18px;
            background: #2a2a2a; color: #fff; border: 2px solid #444;
            border-radius: 5px; padding: 10px;
        }
        #input:focus { outline: none; border-color: #4CAF50; }
        .hidden { display: none; }
        #restart {
            background: #4CAF50; color: white; border: none;
            padding: 10px 20px; font-size: 16px; border-radius: 5px; cursor: pointer;
            margin-top: 10px;
        }
        #restart:hover { background: #45a049; }
    </style>
</head>
<body>
    <div class="stats">
        <div class="stat">WPM: <span id="wpm" class="stat-value">0</span></div>
        <div class="stat">Accuracy: <span id="accuracy" class="stat-value">100%</span></div>
        <div class="stat">Time: <span id="time" class="stat-value">0:00</span></div>
    </div>

    <div id="textDisplay"></div>
    <textarea id="input" placeholder="Start typing here..." autofocus></textarea>
    <button id="restart">Restart (Tab)</button>

    <script>
        const params = new URLSearchParams(window.location.search);
        const textParam = params.get('text');
        const defaultText = "The quick brown fox jumps over the lazy dog. " +
            "Pack my box with five dozen liquor jugs. " +
            "How vexingly quick daft zebras jump!";

        let targetText = textParam ? decodeURIComponent(textParam) : defaultText;
        let startTime = null;
        let completed = false;

        const display = document.getElementById('textDisplay');
        const input = document.getElementById('input');
        const wpmDisplay = document.getElementById('wpm');
        const accuracyDisplay = document.getElementById('accuracy');
        const timeDisplay = document.getElementById('time');
        const restartBtn = document.getElementById('restart');

        function renderText() {
            const typed = input.value;
            let html = '';

            for (let i = 0; i < targetText.length; i++) {
                if (i < typed.length) {
                    if (typed[i] === targetText[i]) {
                        html += `<span class="correct">${escapeHtml(targetText[i])}</span>`;
                    } else {
                        html += `<span class="incorrect">${escapeHtml(targetText[i])}</span>`;
                    }
                } else if (i === typed.length) {
                    html += `<span class="current">${escapeHtml(targetText[i])}</span>`;
                } else {
                    html += escapeHtml(targetText[i]);
                }
            }
            display.innerHTML = html;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function calculateStats() {
            if (!startTime) return;

            const typed = input.value;
            const correct = typed.split('').filter((c, i) => c === targetText[i]).length;
            const accuracy = typed.length > 0 ? Math.round((correct / typed.length) * 100) : 100;

            const elapsed = (Date.now() - startTime) / 1000 / 60; // minutes
            const words = typed.trim().split(/\s+/).length;
            const wpm = elapsed > 0 ? Math.round(words / elapsed) : 0;

            wpmDisplay.textContent = wpm;
            accuracyDisplay.textContent = accuracy + '%';

            const minutes = Math.floor(elapsed * 60 / 60);
            const seconds = Math.floor(elapsed * 60 % 60);
            timeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function checkCompletion() {
            if (input.value === targetText && !completed) {
                completed = true;
                input.style.borderColor = '#4CAF50';
                input.placeholder = 'Complete! Press Tab to restart';
            }
        }

        function restart() {
            input.value = '';
            completed = false;
            startTime = null;
            input.style.borderColor = '#444';
            input.focus();
            renderText();
            wpmDisplay.textContent = '0';
            accuracyDisplay.textContent = '100%';
            timeDisplay.textContent = '0:00';
        }

        input.addEventListener('input', () => {
            if (!startTime && input.value.length > 0) {
                startTime = Date.now();
            }
            renderText();
            calculateStats();
            checkCompletion();
        });

        input.addEventListener('keydown', (e) => {
            if (e.key === 'Tab') {
                e.preventDefault();
                restart();
            }
        });

        restartBtn.addEventListener('click', restart);

        // Initial render
        renderText();
        input.focus();
    </script>
</body>
</html>
